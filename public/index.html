<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>ElectroLens â€“ AI Electronics Encyclopedia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* -------------------------------------- */
    /* ROOT VARIABLES */
    /* -------------------------------------- */
    :root {
        /* Dark Mode (Default) */
        --bg-body: #09090b;
        --bg-panel: #18181b;
        --bg-panel-translucent: rgba(24, 24, 27, 0.85);
        --bg-element: #27272a;
        --bg-element-hover: #3f3f46;
        
        --border: #3f3f46;
        --border-light: rgba(255, 255, 255, 0.1);
        
        --primary: #3b82f6;
        --primary-hover: #60a5fa;
        --primary-dim: rgba(59, 130, 246, 0.15);
        --primary-glow: rgba(59, 130, 246, 0.4);
        
        --text-main: #f4f4f5;
        --text-muted: #a1a1aa;
        --text-dim: #71717a;

        --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
        --font-mono: 'JetBrains Mono', monospace;

        --radius-xl: 20px;
        --radius-lg: 12px;
        --radius-md: 8px;
        --radius-sm: 6px;

        --shadow-glow: 0 0 20px rgba(59, 130, 246, 0.15);
        --shadow-card: 0 8px 30px rgba(0, 0, 0, 0.3);
        
        --gradient-overlay: linear-gradient(to top, rgba(0,0,0,0.9), transparent 60%);
    }

    /* Light Mode Overrides */
    :root[data-theme="light"] {
        --bg-body: #f1f5f9;
        --bg-panel: #ffffff;
        --bg-panel-translucent: rgba(255, 255, 255, 0.9);
        --bg-element: #f8fafc;
        --bg-element-hover: #e2e8f0;
        
        --border: #cbd5e1;
        --border-light: rgba(0, 0, 0, 0.05);
        
        --primary: #2563eb;
        --primary-hover: #1d4ed8;
        --primary-dim: rgba(37, 99, 235, 0.1);
        --primary-glow: rgba(37, 99, 235, 0.2);
        
        --text-main: #0f172a;
        --text-muted: #475569;
        --text-dim: #94a3b8;

        --shadow-glow: 0 4px 20px rgba(37, 99, 235, 0.15);
        --shadow-card: 0 10px 40px -10px rgba(0, 0, 0, 0.08);

        --gradient-overlay: linear-gradient(to top, rgba(255,255,255,0.9), transparent 60%);
    }

    /* -------------------------------------- */
    /* RESET & BASE */
    /* -------------------------------------- */
    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

    body {
        font-family: var(--font-sans);
        background-color: var(--bg-body);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem 1.5rem;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Dot Pattern Background */
    body::before {
        content: "";
        position: fixed;
        inset: 0;
        z-index: -1;
        background-image: radial-gradient(var(--border) 1px, transparent 1px);
        background-size: 24px 24px;
        opacity: 0.2;
        mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 99px; border: 2px solid var(--bg-panel); }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

    .shell {
        width: 100%;
        max-width: 1280px;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    /* -------------------------------------- */
    /* HEADER */
    /* -------------------------------------- */
    .site-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 0.5rem;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .logo-box {
        width: 42px;
        height: 42px;
        background: var(--primary);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: white;
        box-shadow: var(--shadow-glow);
        transition: transform 0.2s;
    }
    
    .brand:hover .logo-box { transform: scale(1.05) rotate(5deg); }

    .brand-info h1 {
        font-size: 1.25rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        line-height: 1.1;
        color: var(--text-main);
    }

    .brand-info p {
        font-size: 0.8rem;
        color: var(--text-muted);
        font-weight: 500;
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    .nav-link {
        font-size: 0.875rem;
        color: var(--text-muted);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
        display: none;
        cursor: pointer;
    }
    .nav-link:hover { color: var(--primary); }
    @media (min-width: 768px) { .nav-link { display: block; } }

    .theme-toggle {
        background: var(--bg-element);
        border: 1px solid var(--border);
        color: var(--text-muted);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .theme-toggle:hover {
        background: var(--bg-element-hover);
        color: var(--text-main);
        border-color: var(--text-muted);
        transform: rotate(15deg);
    }

    /* -------------------------------------- */
    /* MAIN GRID LAYOUT */
    /* -------------------------------------- */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        min-height: 600px;
    }

    @media (min-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: 380px 1fr;
            align-items: start;
        }
    }

    /* -------------------------------------- */
    /* CARDS & PANELS */
    /* -------------------------------------- */
    .card {
        background: var(--bg-panel-translucent);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        box-shadow: var(--shadow-card);
        height: 100%;
        position: relative;
        transition: border-color 0.3s ease, background-color 0.3s ease;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-title {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 700;
        color: var(--text-dim);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-title::before {
        content: '';
        width: 6px;
        height: 6px;
        background: var(--primary);
        border-radius: 50%;
        box-shadow: 0 0 8px var(--primary);
    }

    /* -------------------------------------- */
    /* LEFT COLUMN: INPUTS */
    /* -------------------------------------- */
    .mode-switcher {
        display: flex;
        background: var(--bg-element);
        padding: 4px;
        border-radius: var(--radius-lg);
        gap: 4px;
        border: 1px solid var(--border);
    }

    .mode-btn {
        flex: 1;
        background: transparent;
        border: none;
        padding: 8px;
        border-radius: var(--radius-md);
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.2s;
    }

    .mode-btn:hover { color: var(--text-main); }
    .mode-btn.active {
        background: var(--bg-panel);
        color: var(--primary);
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* Camera Viewport */
    .viewport-container {
        position: relative;
        width: 100%;
        aspect-ratio: 4/3;
        background: #000;
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--border);
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
    }

    .viewport-video, .viewport-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .viewport-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
        background: rgba(0,0,0,0.3);
        pointer-events: none;
    }

    /* Reticle animation */
    .reticle {
        width: 60%;
        height: 60%;
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: var(--radius-md);
        position: relative;
        box-shadow: 0 0 0 999px rgba(0, 0, 0, 0.5);
    }
    
    .reticle::after, .reticle::before, 
    .reticle-corner-bl, .reticle-corner-tr {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        border-color: var(--primary);
        border-style: solid;
        transition: all 0.3s;
    }
    
    .reticle::before { top: -2px; left: -2px; border-width: 3px 0 0 3px; border-radius: 4px 0 0 0; }
    .reticle::after { bottom: -2px; right: -2px; border-width: 0 3px 3px 0; border-radius: 0 0 4px 0; }
    
    /* Controls */
    .control-row {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .btn-primary {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.6rem;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255, 255, 255, 0.1);
        flex: 2;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        box-shadow: 0 4px 15px var(--primary-glow), inset 0 1px 0 rgba(255,255,255,0.2);
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        position: relative;
        overflow: hidden;
    }
    
    .btn-primary::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: 0.5s;
    }

    .btn-primary:hover:not(:disabled)::after {
        left: 100%;
    }

    .btn-primary:hover:not(:disabled) { 
        transform: translateY(-2px); 
        box-shadow: 0 8px 25px var(--primary-glow);
        filter: brightness(1.1);
    }
    .btn-primary:active:not(:disabled) { transform: translateY(0); }
    .btn-primary:disabled { 
        background: var(--bg-element); 
        color: var(--text-dim); 
        border: 1px solid var(--border);
        cursor: not-allowed; 
        box-shadow: none; 
        transform: none;
        background-image: none;
    }

    /* Updated Camera Toggle Button Design */
    .btn-camera-toggle {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.6rem;
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
        flex: 1;
    }

    /* Start State (Green) */
    .btn-camera-toggle.start {
        background: rgba(16, 185, 129, 0.1); /* Emerald-500 tint */
        color: #10b981;
        border-color: rgba(16, 185, 129, 0.3);
    }
    .btn-camera-toggle.start:hover {
        background: rgba(16, 185, 129, 0.15);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
    }

    /* Stop State (Red) */
    .btn-camera-toggle.stop {
        background: rgba(239, 68, 68, 0.1); /* Red-500 tint */
        color: #ef4444;
        border-color: rgba(239, 68, 68, 0.3);
    }
    .btn-camera-toggle.stop:hover {
        background: rgba(239, 68, 68, 0.15);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.15);
    }

    .btn-secondary {
        background: var(--bg-element);
        color: var(--text-main);
        border: 1px solid var(--border);
    }
    .btn-secondary:hover { 
        background: var(--bg-element-hover);
        border-color: var(--text-muted); 
    }

    /* Upload Zone */
    .upload-zone {
        border: 2px dashed var(--border);
        border-radius: var(--radius-lg);
        height: 280px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: var(--text-muted);
        transition: all 0.2s;
        cursor: pointer;
        background: var(--bg-element);
        position: relative;
        overflow: hidden;
    }
    .upload-zone:hover, .upload-zone.dragover {
        border-color: var(--primary);
        background: var(--primary-dim);
        color: var(--primary);
    }
    .upload-zone svg { width: 48px; height: 48px; margin-bottom: 1rem; stroke-width: 1.5px; }

    /* Manual Input */
    .input-group {
        display: flex;
        gap: 0.5rem;
    }
    .text-input {
        flex: 1;
        background: var(--bg-element);
        border: 1px solid var(--border);
        color: var(--text-main);
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
        font-family: var(--font-sans);
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    .text-input:focus { 
        border-color: var(--primary); 
        box-shadow: 0 0 0 3px var(--primary-dim);
    }
    .text-input::placeholder { color: var(--text-dim); }

    /* -------------------------------------- */
    /* RIGHT COLUMN: ENCYCLOPEDIA */
    /* -------------------------------------- */
    .ency-header {
        border-bottom: 1px solid var(--border);
        padding-bottom: 1.25rem;
        margin-bottom: 0.5rem;
    }

    .chip-container {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
        flex-wrap: wrap;
    }

    .chip {
        font-size: 0.7rem;
        font-family: var(--font-mono);
        text-transform: uppercase;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 99px;
        background: var(--primary-dim);
        color: var(--primary);
        border: 1px solid rgba(59, 130, 246, 0.2);
    }

    .part-name {
        font-size: 2.25rem;
        font-weight: 800;
        line-height: 1.1;
        color: var(--text-main);
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
    }

    .part-category {
        font-family: var(--font-mono);
        color: var(--text-muted);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .part-category::before {
        content: "#";
        color: var(--primary);
    }

    /* Scroll Area */
    .ency-content {
        flex: 1;
        overflow-y: auto;
        padding-right: 0.5rem;
    }

    .data-section {
        margin-bottom: 2rem;
    }

    .section-label {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--text-dim);
        margin-bottom: 0.85rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .section-label::after {
        content: "";
        flex: 1;
        height: 1px;
        background: var(--border);
        opacity: 0.5;
    }

    .section-body {
        font-size: 1rem;
        line-height: 1.6;
        color: var(--text-muted);
    }
    
    .section-body p { margin-bottom: 0.75rem; }
    .section-body ul { list-style: none; padding: 0; display: grid; gap: 0.5rem; }
    .section-body li { 
        position: relative; 
        padding-left: 1.5rem; 
        color: var(--text-main);
        font-size: 0.95rem;
    }
    .section-body li::before {
        content: "â€¢";
        position: absolute;
        left: 0.25rem;
        color: var(--primary);
        font-weight: bold;
    }

    /* Images Grid */
    .ref-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.75rem;
        margin-top: 1rem;
    }
    
    .ref-item {
        background: var(--bg-element);
        border-radius: var(--radius-md);
        padding: 4px;
        border: 1px solid var(--border);
        overflow: hidden;
        transition: transform 0.2s, border-color 0.2s;
    }
    .ref-item:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
    }
    
    .ref-image-box {
        aspect-ratio: 1;
        width: 100%;
        background: #fff; /* White bg for components looks cleaner */
        border-radius: var(--radius-sm);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    /* Dark mode toggle for image background if desired, keeping white for clarity of schematics */
    :root[data-theme="dark"] .ref-image-box { background: #fff; } 
    :root[data-theme="light"] .ref-image-box { background: #f1f5f9; }

    .ref-item img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        display: block;
    }

    .ref-caption {
        font-size: 0.7rem;
        text-align: center;
        padding: 6px 0 2px;
        color: var(--text-dim);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Links */
    .link-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .chip-link {
        font-size: 0.8rem;
        text-decoration: none;
        padding: 8px 14px;
        background: var(--bg-element);
        color: var(--text-main);
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
    }
    .chip-link:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--primary-dim);
        transform: translateY(-1px);
    }

    /* Footer / Status */
    .status-bar {
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        color: var(--text-dim);
        font-family: var(--font-mono);
    }

    .loader {
        width: 18px;
        height: 18px;
        border: 2px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        display: none;
    }
    
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(4px);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }
    .modal.active { display: flex; }
    .modal-content {
        background: var(--bg-panel);
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        max-width: 500px;
        width: 100%;
        padding: 1.5rem;
        box-shadow: var(--shadow-card);
        position: relative;
        animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.5rem;
    }
    .modal-header h3 {
        color: var(--text-main);
        font-size: 1.1rem;
        font-weight: 600;
    }
    .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text-muted);
        cursor: pointer;
        padding: 0 0.5rem;
    }
    .close-modal:hover { color: var(--text-main); }
    .modal-body h4 { margin: 1rem 0 0.5rem; color: var(--text-main); font-size: 0.95rem; font-weight: 600; }
    .modal-body p { font-size: 0.9rem; color: var(--text-muted); line-height: 1.5; margin-bottom: 0.5rem; }
    .modal-body ul { padding-left: 1.2rem; margin-bottom: 1rem; color: var(--text-muted); font-size: 0.9rem; line-height: 1.5; }
    .modal-body li { margin-bottom: 0.4rem; }
    .modal-body strong { color: var(--text-main); }

    .site-footer {
        font-size: 0.75rem;
        color: var(--text-dim);
        text-align: center;
        margin-top: auto;
        padding-top: 1rem;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
        body { padding: 1rem; }
        .dashboard-grid { min-height: auto; gap: 1rem; }
        .card { padding: 1.25rem; border-radius: var(--radius-lg); }
        .part-name { font-size: 1.75rem; }
        .mode-switcher { overflow-x: auto; }
        .ref-grid { grid-template-columns: repeat(3, 1fr); }
    }
    
    @media (max-width: 480px) {
        .ref-grid { grid-template-columns: 1fr; } 
        .ref-image-box { aspect-ratio: 16/9; }
    }
  </style>
</head>
<body>

<div class="shell">
  <!-- HEADER -->
  <header class="site-header">
    <div class="brand">
      <div class="logo-box">âš¡</div>
      <div class="brand-info">
        <h1>ElectroLens</h1>
        <p>AI Component Analyzer</p>
      </div>
    </div>
    <div class="header-actions">
      <a id="aboutLink" class="nav-link">About</a>
      <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
        <!-- Sun Icon -->
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <!-- Moon Icon -->
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </button>
    </div>
  </header>

  <div class="dashboard-grid">
    
    <!-- LEFT PANEL: INPUT -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">Input Source</div>
        <div class="loader" id="cameraLoader"></div>
      </div>

      <div class="mode-switcher">
        <button class="mode-btn active" data-mode="camera">Camera</button>
        <button class="mode-btn" data-mode="upload">Upload</button>
        <button class="mode-btn" data-mode="manual">Manual</button>
      </div>

      <!-- Mode: Camera -->
      <div id="mode-camera" class="mode-content">
        <div class="viewport-container">
          <video id="camera" class="viewport-video" autoplay playsinline muted></video>
          <img id="cameraCapturePreview" class="viewport-img" style="display:none;" />
          
          <div class="viewport-overlay" id="camOverlay">
            <!-- Clean viewfinder: No reticle or text -->
          </div>
        </div>
        <div style="margin-top:1rem; display: flex; justify-content: space-between; align-items: center;">
            <span id="cameraStatusText" style="font-size:0.75rem; color:var(--text-dim); font-family:var(--font-mono);">STATUS: IDLE</span>
        </div>
        <div class="control-row">
            <button class="btn-camera-toggle start" id="toggleCameraBtn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                Start Camera
            </button>
            <button class="btn-primary" id="analyzeCameraBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                Scan & Analyze
            </button>
        </div>
      </div>

      <!-- Mode: Upload -->
      <div id="mode-upload" class="mode-content" style="display:none;">
        <div class="upload-zone" id="uploadDropzone">
            <div id="uploadPrompt">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <p style="font-weight:600; margin-bottom:0.25rem;">Click or Drop Image</p>
                <span style="font-size:0.8rem; opacity:0.6">Supports JPG, PNG, WEBP</span>
            </div>
            <img id="uploadPreview" class="viewport-img" style="display:none; height: 100%; object-fit:contain;" />
            <input type="file" id="fileInput" accept="image/*" hidden />
        </div>
        <div class="control-row" style="margin-top: 1rem;">
            <button class="btn-primary" id="analyzeUploadBtn" disabled>Analyze Image</button>
        </div>
      </div>

      <!-- Mode: Manual -->
      <div id="mode-manual" class="mode-content" style="display:none;">
        <div style="height: 280px; display: flex; flex-direction: column; justify-content: center;">
            <label style="font-size:0.8rem; color:var(--text-muted); margin-bottom:0.5rem; font-weight:600;">ENTER PART NUMBER OR NAME</label>
            <div class="input-group">
                <input type="text" id="manualInput" class="text-input" placeholder="e.g. ESP32, LM7805, 10k Resistor..." />
                <button class="btn-primary" id="manualSearchBtn" style="flex:0; padding:0 1.5rem;">Go</button>
            </div>
            <div style="margin-top:1.5rem; padding:1rem; background:var(--bg-element); border-radius:var(--radius-md); border:1px solid var(--border);">
                <p style="font-size:0.8rem; color:var(--text-dim); line-height:1.5;">
                    <strong style="color:var(--text-main);">Tip:</strong> Be specific for best results. Instead of just "capacitor", try "100uF 16V electrolytic capacitor".
                </p>
            </div>
        </div>
      </div>

      <!-- Hidden Canvas for capture -->
      <canvas id="captureCanvas" style="display:none;"></canvas>

    </section>


    <!-- RIGHT PANEL: OUTPUT -->
    <section class="card">
      <div class="card-header">
        <div class="card-title">Analysis Protocol</div>
        <div class="loader" id="globalLoader"></div>
      </div>

      <div class="ency-content">
        <!-- Header Info -->
        <div class="ency-header">
            <div class="chip-container">
                <span class="chip">AI Vision v2</span>
                <span class="chip">Datasheet Search</span>
            </div>
            <h2 class="part-name" id="deviceName">Ready to Scan</h2>
            <div class="part-category" id="deviceCategory">Waiting for input...</div>
        </div>

        <!-- Dynamic Sections -->
        <div id="resultsContainer">
            
            <div class="data-section">
                <div class="section-label">Overview</div>
                <div class="section-body" id="description">
                    <p>Position an electronic component in the camera view or upload a clear image to begin identification and datasheet retrieval.</p>
                </div>
            </div>

            <div class="data-section">
                <div class="section-label">Key Specifications</div>
                <div class="section-body" id="keySpecs">
                    <p class="text-muted">â€“</p>
                </div>
            </div>

            <div class="data-section">
                <div class="section-label">Typical Uses</div>
                <div class="section-body" id="typicalUses">
                    <p class="text-muted">â€“</p>
                </div>
            </div>

            <div class="data-section">
                <div class="section-label">Common Mistakes</div>
                <div class="section-body" id="commonMistakes">
                    <p class="text-muted">â€“</p>
                </div>
            </div>

            <div class="data-section">
                <div class="section-label">Visual Verification</div>
                <div class="ref-grid">
                    <div class="ref-item">
                        <div class="ref-image-box">
                            <img id="refImage" alt="" style="display:none">
                        </div>
                        <div class="ref-caption">Reference</div>
                    </div>
                    <div class="ref-item">
                        <div class="ref-image-box">
                            <img id="pinoutImage" alt="" style="display:none">
                        </div>
                        <div class="ref-caption">Pinout</div>
                    </div>
                    <div class="ref-item">
                        <div class="ref-image-box">
                            <img id="usageImage" alt="" style="display:none">
                        </div>
                        <div class="ref-caption">Circuit</div>
                    </div>
                </div>
            </div>

            <div class="data-section">
                <div class="section-label">External Resources</div>
                <div class="section-body" id="datasheetHint"></div>
                <div class="link-group" id="referencesSection" style="margin-top:0.75rem;"></div>
                <div class="section-label" style="margin-top:1.5rem;">Purchase Links</div>
                <div class="link-group" id="shopLinks" style="width:100%;"></div>
            </div>

        </div>
      </div>

      <div class="status-bar">
        <span id="aiStatusText">System Idle</span>
        <span>ElectroLens v2.0</span>
      </div>
    </section>

  </div>
  
  <footer class="site-footer">
    &copy; 2025 ElectroLens. AI responses may vary.
  </footer>
</div>

<!-- ABOUT MODAL -->
<div id="aboutModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>About ElectroLens</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <p><strong>ElectroLens</strong> is an intelligent encyclopedia for electronics enthusiasts, engineers, and makers, designed to identify components instantly.</p>
      
      <h4>How it works</h4>
      <ul>
        <li><strong>Vision Analysis:</strong> We use Google's <strong>Gemini Vision</strong> model to identify components from your camera or uploaded images.</li>
        <li><strong>Data Enrichment:</strong> Once identified, the system intelligently searches for datasheets, pinout diagrams, and shopping links.</li>
        <li><strong>Privacy:</strong> Images are processed for analysis and not permanently stored.</li>
      </ul>
      
      <h4>Tech Stack</h4>
      <ul>
        <li>Frontend: HTML5, CSS3, Vanilla JS</li>
        <li>AI Model: Gemini 1.5 Flash (Google DeepMind)</li>
        <li>Search: Google Custom Search API & Serper</li>
      </ul>

      <p style="font-size:0.8rem; margin-top:1.5rem; color:var(--text-dim); border-top:1px solid var(--border); padding-top:1rem;">
        <strong>Disclaimer:</strong> AI outputs can be inaccurate. Always verify pinouts, voltage ratings, and safety instructions with official manufacturer datasheets before powering up circuits.
      </p>
    </div>
  </div>
</div>

<script>
  // Theme logic
  const root = document.documentElement;
  const toggleBtn = document.getElementById('themeToggle');
  const sunIcon = document.querySelector('.sun-icon');
  const moonIcon = document.querySelector('.moon-icon');
  
  function setTheme(theme) {
    root.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    if (theme === 'dark') {
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
    } else {
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
    }
  }
  
  toggleBtn.addEventListener('click', () => {
    const current = root.getAttribute('data-theme') || 'dark';
    setTheme(current === 'dark' ? 'light' : 'dark');
  });

  // Init theme
  const savedTheme = localStorage.getItem('theme') || 'dark';
  setTheme(savedTheme);

  // Modal Logic
  const aboutLink = document.getElementById('aboutLink');
  const aboutModal = document.getElementById('aboutModal');
  const closeModal = document.querySelector('.close-modal');

  if(aboutLink && aboutModal) {
      aboutLink.addEventListener('click', (e) => {
          e.preventDefault();
          aboutModal.classList.add('active');
      });
  }
  
  const hideModal = () => aboutModal.classList.remove('active');
  
  if(closeModal) closeModal.addEventListener('click', hideModal);
  
  aboutModal.addEventListener('click', (e) => {
      if(e.target === aboutModal) hideModal();
  });

  // Tab Switching
  const modeBtns = document.querySelectorAll('.mode-btn');
  const modeContents = document.querySelectorAll('.mode-content');
  
  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        modeBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const mode = btn.dataset.mode;
        modeContents.forEach(c => c.style.display = c.id === `mode-${mode}` ? 'block' : 'none');
        
        if(mode !== 'camera') stopCamera();
    });
  });

  // DOM Elements
  const video = document.getElementById("camera");
  const cameraPreview = document.getElementById("cameraCapturePreview");
  const camOverlay = document.getElementById("camOverlay");
  const analyzeCameraBtn = document.getElementById("analyzeCameraBtn");
  const toggleCameraBtn = document.getElementById("toggleCameraBtn");
  const cameraStatusText = document.getElementById("cameraStatusText");
  const canvas = document.getElementById("captureCanvas");
  
  const uploadDropzone = document.getElementById("uploadDropzone");
  const fileInput = document.getElementById("fileInput");
  const uploadPreview = document.getElementById("uploadPreview");
  const uploadPrompt = document.getElementById("uploadPrompt");
  const analyzeUploadBtn = document.getElementById("analyzeUploadBtn");

  const manualInput = document.getElementById("manualInput");
  const manualSearchBtn = document.getElementById("manualSearchBtn");

  // Output Elements
  const els = {
    name: document.getElementById("deviceName"),
    category: document.getElementById("deviceCategory"),
    desc: document.getElementById("description"),
    specs: document.getElementById("keySpecs"),
    uses: document.getElementById("typicalUses"),
    mistakes: document.getElementById("commonMistakes"),
    refImg: document.getElementById("refImage"),
    pinImg: document.getElementById("pinoutImage"),
    useImg: document.getElementById("usageImage"),
    refs: document.getElementById("referencesSection"),
    shops: document.getElementById("shopLinks"),
    hint: document.getElementById("datasheetHint"),
    status: document.getElementById("aiStatusText"),
    loader: document.getElementById("globalLoader")
  };

  let cameraStream = null;
  let isAnalyzing = false;

  // Icons for JS
  const ICONS = {
    play: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`,
    stop: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>`
  };

  // Camera Logic
  async function startCamera() {
    try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            cameraStatusText.textContent = "Camera API unavailable";
            return;
        }
        
        // Updated constraints for better mobile support
        const constraints = {
            audio: false,
            video: {
                facingMode: "environment",
                width: { ideal: 1280 },
                height: { ideal: 720 }
            }
        };

        try {
            cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        } catch (e) {
            console.warn("Environment camera failed, trying default...", e);
            cameraStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        }

        video.srcObject = cameraStream;
        
        // Explicitly play to avoid autoplay issues on some mobile browsers
        try {
            await video.play();
        } catch (playErr) {
            console.error("Video play error:", playErr);
        }

        video.style.display = "block";
        cameraPreview.style.display = "none";
        camOverlay.style.display = "flex";
        
        analyzeCameraBtn.disabled = false;
        
        // UPDATE BUTTON STATE
        toggleCameraBtn.innerHTML = `${ICONS.stop} Stop Camera`;
        toggleCameraBtn.className = "btn-camera-toggle stop";
        
        cameraStatusText.textContent = "STATUS: ACTIVE";
    } catch (err) {
        console.error("Camera Error:", err);
        let msg = "Camera error";
        if (err.name === 'NotAllowedError') msg = "Permission denied";
        else if (err.name === 'NotFoundError') msg = "No camera found";
        else if (err.name === 'NotReadableError') msg = "Camera in use";
        else if (!window.isSecureContext) msg = "HTTPS required for camera";
        
        cameraStatusText.textContent = `Error: ${msg}`;
    }
  }

  function stopCamera() {
    if (cameraStream) {
        cameraStream.getTracks().forEach(t => t.stop());
        cameraStream = null;
    }
    video.style.display = "none";
    
    // UPDATE BUTTON STATE
    toggleCameraBtn.innerHTML = `${ICONS.play} Start Camera`;
    toggleCameraBtn.className = "btn-camera-toggle start";
    
    cameraStatusText.textContent = "STATUS: STOPPED";
  }

  toggleCameraBtn.addEventListener('click', () => {
    if(cameraStream) stopCamera();
    else startCamera();
  });

  // Capture & Analyze
  analyzeCameraBtn.addEventListener('click', async () => {
    if (!cameraStream || isAnalyzing) return;
    
    // Capture
    const w = video.videoWidth;
    const h = video.videoHeight;
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, w, h);
    
    const dataURL = canvas.toDataURL('image/jpeg', 0.85);
    
    // UI Update
    video.style.display = "none";
    camOverlay.style.display = "none";
    cameraPreview.src = dataURL;
    cameraPreview.style.display = "block";
    stopCamera(); 
    
    await runAnalysis({ image: dataURL });
  });

  // Upload Logic
  uploadDropzone.addEventListener('click', () => fileInput.click());
  
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files?.[0];
    if(file) handleFile(file);
  });
  
  // Drag and drop handlers
  uploadDropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadDropzone.classList.add('dragover');
  });
  uploadDropzone.addEventListener('dragleave', () => {
      uploadDropzone.classList.remove('dragover');
  });
  uploadDropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadDropzone.classList.remove('dragover');
      const file = e.dataTransfer.files?.[0];
      if(file) handleFile(file);
  });

  function handleFile(file) {
    if (!file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const url = e.target.result;
        uploadPreview.src = url;
        uploadPreview.style.display = "block";
        uploadPrompt.style.display = "none";
        analyzeUploadBtn.disabled = false;
        
        analyzeUploadBtn.onclick = () => runAnalysis({ image: url });
    };
    reader.readAsDataURL(file);
  }

  // Manual Logic
  manualSearchBtn.addEventListener('click', () => {
    const txt = manualInput.value.trim();
    if(txt) runAnalysis({ queryText: txt });
  });
  
  manualInput.addEventListener('keypress', (e) => {
      if(e.key === 'Enter') manualSearchBtn.click();
  });

  // Main Analysis Function
  async function runAnalysis(payload) {
    if(isAnalyzing) return;
    isAnalyzing = true;
    els.loader.style.display = "block";
    els.status.textContent = "Processing with Gemini...";
    
    // Reset UI
    els.name.textContent = "Analyzing...";
    els.category.textContent = "Please wait";
    
    try {
        const res = await fetch('/api/electro-lookup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        
        const data = await res.json();
        
        if(!res.ok) throw new Error(data.error || "API Error");
        
        populateResults(data);
        els.status.textContent = "Analysis Complete";

    } catch (err) {
        console.error(err);
        els.name.textContent = "Error";
        els.desc.innerHTML = `<p style="color:#ef4444">Failed: ${err.message}. Check API configuration.</p>`;
        els.status.textContent = "Failed";
    } finally {
        isAnalyzing = false;
        els.loader.style.display = "none";
    }
  }

  function renderList(el, items) {
    if(!items || items.length === 0) {
        el.innerHTML = '<p class="text-muted">None available</p>';
        return;
    }
    el.innerHTML = `<ul>${items.map(i => `<li>${i}</li>`).join('')}</ul>`;
  }

  function populateResults(data) {
    els.name.textContent = data.name || "Unknown";
    els.category.textContent = data.category || "General Electronics";
    
    els.desc.innerHTML = `<p>${data.description || "No description available."}</p>`;
    
    renderList(els.specs, data.key_specs);
    renderList(els.uses, data.typical_uses);
    renderList(els.mistakes, data.common_mistakes);
    
    // Images
    const updateImg = (el, src) => {
        if(src) {
            el.src = src;
            el.style.display = "block";
        } else {
            el.style.display = "none";
        }
    };
    updateImg(els.refImg, data.real_image);
    updateImg(els.pinImg, data.pinout_image);
    updateImg(els.useImg, data.usage_image);

    // Links
    els.refs.innerHTML = '';
    if(data.datasheet_url) {
        els.refs.innerHTML += `<a href="${data.datasheet_url}" target="_blank" class="chip-link">ðŸ“„ PDF Datasheet</a>`;
    }
    if(data.references) {
        data.references.forEach(r => {
            els.refs.innerHTML += `<a href="${r.url}" target="_blank" class="chip-link">ðŸ”— ${r.title}</a>`;
        });
    }

    els.shops.innerHTML = '';
    if(data.shop_links) {
        Object.entries(data.shop_links).forEach(([name, url]) => {
            els.shops.innerHTML += `<a href="${url}" target="_blank" class="chip-link">ðŸ›’ ${name}</a>`;
        });
    }
    
    els.hint.innerHTML = `<p style="font-size:0.85rem"><i>Tip: Search Google for "${data.datasheet_hint || data.name + ' datasheet'}"</i></p>`;
  }

  // Auto-start camera on load if available
  window.addEventListener('load', () => {
    // Optional: Start camera automatically
    // startCamera();
  });

</script>
</body>
</html>