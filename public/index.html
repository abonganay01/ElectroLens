<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>ElectroLens ‚Äì AI Electronics Encyclopedia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* -------------------------------------- */
    /* ROOT VARIABLES (Dark Mode Default) */
    /* -------------------------------------- */
    :root {
        --bg: #0C0D11;
        --panel: #14161A;
        --panel-soft: #1E2125;
        --accent: #5C7CFA;
        --accent-dark: #3F60D5;
        --border: rgba(148, 163, 184, 0.15);
        --text: #F1F3F5;
        --muted: #A0AEC0;
        --radius-lg: 24px;
        --radius-md: 16px;
        --radius-sm: 8px;
        --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.5), 0 2px 5px rgba(0, 0, 0, 0.5);
        --shadow-card: 0 16px 36px rgba(0, 0, 0, 0.5), 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    /* -------------------------------------- */
    /* LIGHT MODE OVERRIDES */
    /* -------------------------------------- */
    :root[data-theme="light"] {
        --bg: #F4F7FB;
        --panel: #FFFFFF;
        --panel-soft: #F9FAFC;
        --accent: #4F69F8;
        --accent-dark: #354FC2;
        --border: rgba(148, 163, 184, 0.3);
        --text: #1A202C;
        --muted: #6B7280;
        --shadow-soft: 0 6px 16px rgba(0, 0, 0, 0.08);
        --shadow-card: 0 12px 28px rgba(0, 0, 0, 0.1);
    }

    /* -------------------------------------- */
    /* BASE STYLES */
    /* -------------------------------------- */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
        min-height: 100vh;
        background: radial-gradient(circle at top, var(--bg) 0%, #D8DCE3 80%, #C9CED5 100%);
        color: var(--text);
        display: flex;
        justify-content: center;
        padding: 30px 20px;
        transition: background 0.4s ease, color 0.3s ease;
        line-height: 1.6;
        font-size: 14px;
    }

    :root[data-theme="dark"] body {
        background: radial-gradient(circle at top, #14161A, var(--bg) 70%, #000 100%);
    }

    .shell {
        width: 100%;
        max-width: 1280px;
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    /* -------------------------------------- */
    /* HEADER */
    /* -------------------------------------- */
    .site-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
        padding: 0 4px;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .logo-placeholder {
        width: 48px;
        height: 48px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--accent), var(--accent-dark));
        border: 1px solid var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        box-shadow: 0 10px 20px rgba(92, 124, 250, 0.4);
        font-weight: 700;
    }

    :root[data-theme="light"] .logo-placeholder {
        box-shadow: 0 8px 18px rgba(79, 105, 248, 0.25);
    }

    .brand-title {
        font-size: 24px;
        font-weight: 700;
        letter-spacing: 0.01em;
        line-height: 1.2;
    }

    .brand-highlight { color: var(--accent); }

    .brand-subtitle {
        font-size: 13px;
        color: var(--muted);
        margin-top: 2px;
    }

    .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .nav-links {
        display: flex;
        gap: 18px;
        font-size: 13px;
        color: var(--muted);
        opacity: 0.95;
    }
    .nav-links span {
        cursor: pointer;
        transition: color 0.2s ease;
    }
    .nav-links span:hover {
        color: var(--accent);
    }

    .theme-toggle-icon {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--panel-soft);
        cursor: pointer;
        font-size: 18px;
        box-shadow: var(--shadow-soft);
        transition: transform 0.16s ease, box-shadow 0.16s ease, background 0.2s ease;
    }

    .theme-toggle-icon:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    :root[data-theme="light"] .theme-toggle-icon:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    /* -------------------------------------- */
    /* TOP STRIP (small hero bar) */
    /* -------------------------------------- */
    .top-strip {
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        background: radial-gradient(circle at top left, rgba(92, 124, 250, 0.15), var(--panel-soft) 60%);
        padding: 16px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        box-shadow: var(--shadow-soft);
    }

    :root[data-theme="light"] .top-strip {
        background: radial-gradient(circle at top left, rgba(79, 105, 248, 0.1), var(--panel-soft) 60%);
    }

    .top-strip-left {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--muted);
        font-size: 11px;
        font-weight: 500;
    }

    :root[data-theme="light"] .badge {
        background: var(--panel-soft);
    }

    .badge-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10B981;
        box-shadow: 0 0 8px rgba(16, 185, 129, 0.7);
    }

    .top-title {
        font-size: 18px;
        font-weight: 600;
    }

    .top-title span {
        background: linear-gradient(120deg, var(--accent), #4BC0DA);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    .top-text {
        font-size: 13px;
        color: var(--muted);
    }

    .top-strip-right {
        font-size: 12px;
        color: var(--muted);
        text-align: right;
        max-width: 250px;
        line-height: 1.4;
    }

    /* -------------------------------------- */
    /* DASHBOARD LAYOUT */
    /* -------------------------------------- */
    .dashboard {
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        background: var(--panel);
        padding: 16px;
        display: grid;
        grid-template-columns: minmax(0, 0.8fr) minmax(0, 1.2fr);
        gap: 16px;
        min-height: 70vh;
        box-shadow: var(--shadow-card);
    }

    :root[data-theme="light"] .dashboard {
        background: var(--panel-soft);
    }

    @media (max-width: 900px) {
        .dashboard {
            grid-template-columns: 1fr;
        }
    }

    .card {
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        background: var(--panel-soft);
        padding: 16px;
        display: flex;
        flex-direction: column;
        min-height: 0;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.3);
    }

    :root[data-theme="light"] .card {
        background: var(--panel);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.05);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .card-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
        color: var(--muted);
    }

    .card-tag {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 999px;
        background: var(--panel);
        border: 1px solid var(--border);
        color: var(--text);
    }

    :root[data-theme="light"] .card-tag {
        background: #EEF2FF;
        color: var(--accent-dark);
        border-color: rgba(79, 105, 248, 0.5);
    }

    /* -------------------------------------- */
    /* LEFT PANEL (INPUT) */
    /* -------------------------------------- */
    .mode-tabs {
        display: inline-flex;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        padding: 4px;
        margin-bottom: 10px;
    }

    :root[data-theme="light"] .mode-tabs {
        background: #F3F4F6;
    }

    .mode-tab {
        border-radius: 999px;
        border: none;
        background: transparent;
        font-size: 13px;
        font-weight: 500;
        color: var(--muted);
        padding: 8px 16px;
        cursor: pointer;
        transition: 0.2s;
        white-space: nowrap;
    }

    .mode-tab.active {
        background: var(--panel-soft);
        color: var(--text);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    :root[data-theme="light"] .mode-tab.active {
        background: #ffffff;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .model-select-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        font-size: 12px;
        color: var(--muted);
    }

    .model-select-row label {
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 11px;
    }

    .model-select-row select {
        flex: 1;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        padding: 6px 12px;
        font-size: 12px;
        outline: none;
    }

    :root[data-theme="light"] .model-select-row select {
        background: #ffffff;
    }

    .mode-panel { margin-top: 4px; }

    .camera-shell {
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        background: var(--panel);
        padding: 10px;
    }

    :root[data-theme="light"] .camera-shell {
        background: #F9FAFB;
    }

    .glass-frame {
        position: relative;
        border-radius: var(--radius-sm);
        overflow: hidden;
        border: 1px solid rgba(0,0,0,0.8);
        background: black;
        min-height: 250px;
    }

    :root[data-theme="light"] .glass-frame {
        border-color: rgba(15,23,42,0.6);
    }

    .glass-frame video,
    #cameraCapturePreview {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    #cameraCapturePreview {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 10;
        display: none;
    }

    .camera-status {
        position: absolute;
        left: 12px;
        bottom: 12px;
        background: rgba(0, 0, 0, 0.75);
        border-radius: 999px;
        padding: 5px 12px;
        font-size: 11px;
        color: white;
        display: flex;
        align-items: center;
        gap: 8px;
        z-index: 20;
    }

    :root[data-theme="light"] .camera-status {
        background: rgba(0, 0, 0, 0.7);
        color: white;
    }

    .mini-loader {
        width: 16px;
        height: 16px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        display: none;
    }

    .input-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
    }

    .primary-btn {
        border-radius: 999px;
        border: none;
        padding: 9px 18px;
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(120deg, var(--accent), var(--accent-dark));
        color: white;
        cursor: pointer;
        box-shadow: 0 8px 18px rgba(92, 124, 250, 0.4);
        transition: 0.15s;
    }

    .primary-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 14px 28px rgba(92, 124, 250, 0.6);
    }

    .primary-btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }

    .hint {
        margin-top: 10px;
        font-size: 12px;
        color: var(--muted);
        line-height: 1.5;
    }

    .upload-dropzone {
        border-radius: var(--radius-sm);
        border: 2px dashed var(--border);
        background: var(--panel);
        padding: 30px;
        min-height: 250px;
        text-align: center;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition: 0.15s;
    }

    .upload-dropzone:hover {
        border-color: var(--accent);
        background: var(--panel-soft);
    }

    .upload-dropzone.dragover {
        border-color: var(--accent);
        background: radial-gradient(circle at top, rgba(92, 124, 250, 0.15), var(--panel-soft));
        box-shadow: 0 10px 20px rgba(92, 124, 250, 0.3);
        transform: scale(1.0);
    }

    :root[data-theme="light"] .upload-dropzone {
        background: #ffffff;
    }

    .upload-icon svg {
        width: 48px;
        height: 48px;
        stroke: var(--accent);
    }

    .upload-text {
        margin-top: 8px;
        font-size: 14px;
        color: var(--muted);
    }

    #uploadPreview {
        display: none;
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        background: var(--panel);
    }

    .manual-input-row {
        display: flex;
        gap: 10px;
        margin-top: 6px;
    }

    .manual-input-row input {
        flex: 1;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        padding: 9px 16px;
        font-size: 14px;
        transition: border-color 0.2s;
    }

    .manual-input-row input:focus {
        border-color: var(--accent);
        outline: none;
    }

    :root[data-theme="light"] .manual-input-row input {
        background: #ffffff;
    }

    .manual-input-row input::placeholder {
        color: rgba(148, 163, 184, 0.85);
    }

    /* -------------------------------------- */
    /* RIGHT PANEL (ENCYCLOPEDIA) */
    /* -------------------------------------- */
    .ency-body {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex: 1;
        min-height: 0;
        overflow: hidden;
    }

    .ency-header {
        margin-bottom: 6px;
    }

    .ency-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
        color: var(--muted);
    }

    .ency-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
    }

    .ency-chip {
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--accent);
        font-size: 11px;
        font-weight: 500;
    }

    :root[data-theme="light"] .ency-chip {
        background: #EEF2FF;
        color: var(--accent-dark);
    }

    .name-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid var(--border);
    }

    .device-name {
        font-size: 20px;
        font-weight: 700;
    }

    .device-category {
        font-size: 12px;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        font-weight: 500;
    }

    :root[data-theme="light"] .device-category {
        background: #EEF2FF;
        color: var(--accent-dark);
    }

    .ency-scroll {
        margin-top: 8px;
        padding-right: 6px;
        overflow-y: auto;
        flex: 1;
        max-height: calc(100% - 120px);
        scrollbar-color: var(--accent) var(--panel-soft);
    }

    .ency-scroll::-webkit-scrollbar {
        width: 8px;
    }
    .ency-scroll::-webkit-scrollbar-thumb {
        background-color: var(--accent);
        border-radius: 4px;
        border: 2px solid var(--panel-soft);
    }
    .ency-scroll::-webkit-scrollbar-track {
        background: var(--panel-soft);
    }

    .section {
        margin-top: 18px;
        font-size: 14px;
        line-height: 1.6;
    }

    .section-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 6px;
        border-bottom: 1px dashed var(--border);
        padding-bottom: 4px;
    }

    .section-content ul {
        padding-left: 20px;
        list-style-type: '‚Äî ';
        list-style-position: outside;
    }

    .section-content li {
        margin-bottom: 6px;
        padding-left: 6px;
    }

    .placeholder {
        font-style: italic;
        color: var(--muted);
    }

    .ref-link {
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
    }

    .ref-link:hover { text-decoration: underline; color: var(--accent-dark); }

    .ref-snippet {
        font-size: 11px;
        color: var(--muted);
        line-height: 1.4;
        margin-top: 2px;
    }

    .shop-links {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 6px;
    }

    .shop-btn {
        font-size: 13px;
        padding: 6px 12px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        text-decoration: none;
        transition: all 0.2s;
    }

    .shop-btn:hover {
        border-color: var(--accent);
        background: var(--accent);
        color: white;
    }

    :root[data-theme="light"] .shop-btn {
        background: #F3F4F6;
        color: var(--text);
    }

    .ref-image-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 12px;
    }

    @media (max-width: 900px) {
        .ref-image-grid { grid-template-columns: 1fr; }
    }

    .ref-block {
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        background: var(--panel);
        padding: 8px;
        font-size: 11px;
        color: var(--muted);
    }

    :root[data-theme="light"] .ref-block {
        background: var(--panel-soft);
    }

    .ref-img-label {
        margin-bottom: 6px;
        font-size: 12px;
        font-weight: 600;
        color: var(--text);
    }

    .ref-block img {
        width: 100%;
        border-radius: 4px;
        object-fit: cover;
        display: none;
    }

    .status-bar {
        margin-top: auto;
        padding-top: 10px;
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: var(--muted);
    }

    .loader {
        width: 16px;
        height: 16px;
        border-width: 3px;
        border-radius: 50%;
        border: 3px solid rgba(148, 163, 184, 0.3);
        border-top-color: var(--accent);
        animation: spin 0.7s linear infinite;
        display: none;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* -------------------------------------- */
    /* INFO STRIP + FOOTER */
    /* -------------------------------------- */
    .info-strip {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 16px;
    }

    @media (max-width: 900px) {
        .info-strip { grid-template-columns: 1fr; }
    }

    .info-card {
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
        background: var(--panel);
        padding: 14px 16px;
        font-size: 13px;
        color: var(--muted);
        box-shadow: var(--shadow-soft);
    }

    :root[data-theme="light"] .info-card {
        background: #ffffff;
    }

    .info-card h3 {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 4px;
        color: var(--text);
        border-bottom: 1px solid var(--border);
        padding-bottom: 4px;
    }

    footer {
        text-align: center;
        font-size: 12px;
        color: var(--muted);
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid var(--border);
        opacity: 0.85;
    }

    @media (max-width: 600px) {
        .site-header { flex-direction: column; align-items: flex-start; }
        .header-right { margin-top: 10px; gap: 10px; }
        .nav-links { display: none; }
        .top-strip { flex-direction: column; align-items: flex-start; text-align: left; }
        .top-strip-right { text-align: left; max-width: 100%; margin-top: 10px; }
        body { padding: 15px; }
        .shell { gap: 16px; }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- HEADER -->
    <header class="site-header">
      <div class="brand">
        <div class="logo-placeholder">‚ö°</div>
        <div>
          <div class="brand-title">
            <span class="brand-highlight">ElectroLens</span> ‚Äì AI Electronics Encyclopedia
          </div>
          <div class="brand-subtitle">
            Identify components, see specs, and explore projects using Gemini, Groq, DeepSeek, and Google.
          </div>
        </div>
      </div>
      <div class="header-right">
        <nav class="nav-links">
          <span>Dashboard</span>
          <span>How it works</span>
          <span>About</span>
        </nav>
        <button id="themeToggle" class="theme-toggle-icon" title="Toggle dark/light mode">üåô</button>
      </div>
    </header>

    <!-- SMALL HERO STRIP -->
    <section class="top-strip">
      <div class="top-strip-left">
        <div class="badge">
          <span class="badge-dot"></span>
          Live lab assistant ¬∑ Vision + LLM + Web
        </div>
        <div class="top-title">
          Scan electronics parts and <span>instantly get an engineer-style explanation.</span>
        </div>
        <div class="top-text">
          Use the left panel to capture or upload a component. ElectroLens fills the encyclopedia on the right.
        </div>
      </div>
      <div class="top-strip-right">
        Tip: Start with an <b>ESP32 dev board</b>, <b>LM7805</b>, or <b>relay module</b> for a great demo.
      </div>
    </section>

    <!-- DASHBOARD -->
    <section class="dashboard">
      <!-- LEFT: INPUT PANEL -->
      <section class="card">
        <div class="card-header">
          <div class="card-label">Input</div>
          <div class="card-tag">ElectroLens Scanner</div>
        </div>

        <div class="mode-tabs">
          <button class="mode-tab active" data-mode="camera">üì∑ Camera</button>
          <button class="mode-tab" data-mode="upload">üñº Upload</button>
          <button class="mode-tab" data-mode="manual">üîç Type Name</button>
        </div>

        <!-- AI MODEL SELECTOR -->
        <div class="model-select-row">
          <label for="modelSelect">AI Model</label>
          <select id="modelSelect">
            <option value="auto">Auto (Gemini + Groq)</option>
            <option value="gemini">Gemini only</option>
            <option value="groq">Groq</option>
            <option value="deepseek">DeepSeek</option>
          </select>
        </div>

        <!-- CAMERA MODE -->
        <div class="mode-panel" id="mode-camera">
          <div class="camera-shell">
            <div class="glass-frame">
              <video id="camera" autoplay playsinline></video>
              <img id="cameraCapturePreview" alt="Captured frame" />
              <div class="camera-status">
                <div class="mini-loader" id="cameraLoader"></div>
                <span id="cameraStatusText">Waiting for permission‚Ä¶</span>
              </div>
            </div>
          </div>
          <div class="input-controls">
            <button class="primary-btn" id="analyzeCameraBtn" disabled>üîç Analyze frame</button>
            <button class="primary-btn" id="toggleCameraBtn">‚ñ∂ Start camera</button>
          </div>
          <p class="hint">
            Place a single component or board in the center with good lighting for best results.
          </p>
        </div>

        <!-- UPLOAD MODE -->
        <div class="mode-panel" id="mode-upload" style="display:none;">
          <div class="upload-dropzone" id="uploadDropzone">
            <div id="uploadPrompt">
              <div class="upload-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" stroke="currentColor"></path>
                  <path d="M12 3v14" stroke="currentColor"></path>
                  <path d="M7 8l5-5 5 5" stroke="currentColor"></path>
                </svg>
              </div>
              <div class="upload-text">Drag & drop or click to upload an image</div>
            </div>
            <img id="uploadPreview" alt="Upload preview" />
            <input type="file" id="fileInput" accept="image/*" hidden />
          </div>
          <div class="input-controls">
            <button class="primary-btn" id="analyzeUploadBtn" disabled>üîç Analyze image</button>
          </div>
          <p class="hint">
            Works great for clear photos of dev boards, modules, tools, or test equipment.
          </p>
        </div>

        <!-- MANUAL MODE -->
        <div class="mode-panel" id="mode-manual" style="display:none;">
          <p class="hint" style="margin-bottom:4px;">
            Type a part number or component name (e.g. <i>ESP32 DevKitC, LM7805, 2N2222, 10kŒ© resistor 1/4W</i>).
          </p>
          <div class="manual-input-row">
            <input id="manualInput" type="text" placeholder="e.g. ESP32 DevKitC, LM7805, HC-SR04 module">
            <button class="primary-btn" id="manualSearchBtn">Go</button>
          </div>
        </div>

        <canvas id="captureCanvas" style="display:none;"></canvas>
      </section>

      <!-- RIGHT: ENCYCLOPEDIA PANEL -->
      <section class="card">
        <div class="ency-body">
          <div>
            <div class="ency-header">
              <div class="ency-title">ElectroLens Encyclopedia</div>
              <div class="ency-badges">
                <span class="ency-chip">Gemini Vision</span>
                <span class="ency-chip">Groq / DeepSeek</span>
                <span class="ency-chip">Google / Serper</span>
                <span class="ency-chip" id="modelChip">Mode: Auto (Gemini + Groq)</span>
              </div>
            </div>
            <div class="name-row">
              <div class="device-name" id="deviceName">No device analyzed yet</div>
              <div class="device-category" id="deviceCategory">‚Äî</div>
            </div>
          </div>

          <div class="ency-scroll">
            <div class="section">
              <div class="section-title">Overview</div>
              <div class="section-content" id="description">
                <p class="placeholder">
                  Scan or search a component to see a detailed explanation and how it fits into real circuits.
                </p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Typical Uses</div>
              <div class="section-content" id="typicalUses">
                <p class="placeholder">Common applications will appear here.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Where to Buy</div>
              <div class="section-content" id="whereToBuy">
                <p class="placeholder">Shops, distributors, and marketplaces will be listed here.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Key Specs</div>
              <div class="section-content" id="keySpecs">
                <p class="placeholder">Voltage, current, power, and other important parameters will appear here.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Project Ideas</div>
              <div class="section-content" id="projectIdeas">
                <p class="placeholder">Example projects and integrations will appear here.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Common Mistakes & Warnings</div>
              <div class="section-content" id="commonMistakes">
                <p class="placeholder">Typical pitfalls, overheating, polarity or wiring mistakes will appear here.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Datasheet Hint</div>
              <div class="section-content" id="datasheetHint">
                <p class="placeholder">ElectroLens will suggest what to search to quickly find the official datasheet.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Datasheet & References</div>
              <div class="section-content" id="referencesSection">
                <p class="placeholder">Direct datasheet links and reference pages will appear here when available.</p>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Buy Online</div>
              <div class="section-content">
                <div class="shop-links" id="shopLinks"></div>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Reference Images</div>
              <div class="section-content">
                <div class="ref-image-grid">
                  <div class="ref-block">
                    <div class="ref-img-label">Component photo</div>
                    <img id="refImage" alt="Component photo from search" />
                  </div>
                  <div class="ref-block">
                    <div class="ref-img-label">Example usage / application</div>
                    <img id="usageImage" alt="Example usage or application" />
                  </div>
                  <div class="ref-block">
                    <div class="ref-img-label">Pinout diagram</div>
                    <img id="pinoutImage" alt="Pinout diagram from search" />
                  </div>
                </div>
                <p class="hint" style="margin-top:6px;">
                  Images are suggested via Gemini + web context. Always confirm pinouts and specs using the official datasheet.
                </p>
              </div>
            </div>
          </div>

          <div class="status-bar">
            <span id="aiStatusText">Ready ‚Äì choose a mode, pick an AI model, and analyze.</span>
            <div class="loader" id="globalLoader"></div>
          </div>
        </div>
      </section>
    </section>

    <!-- INFO STRIP -->
    <section class="info-strip">
      <article class="info-card">
        <h3>1 ¬∑ Vision & Identification</h3>
        <p>Gemini looks at the image or text and identifies the most likely electronics component, module, or tool.</p>
      </article>
      <article class="info-card">
        <h3>2 ¬∑ Engineering Knowledge</h3>
        <p>Groq or DeepSeek refines the explanation, adds specs, project ideas, and safety notes like an engineer.</p>
      </article>
      <article class="info-card">
        <h3>3 ¬∑ Real-World Links</h3>
        <p>Google Custom Search and Serper find real images, datasheets, and shop links (Shopee, Lazada, Amazon, AliExpress).</p>
      </article>
    </section>

    <!-- FOOTER -->
    <footer>
      ¬© 2025 ElectroLens. All Rights Reserved.
    </footer>
  </div>

<script>
  // Theme toggle
  const themeToggleBtn = document.getElementById("themeToggle");
  const root = document.documentElement;

  function applyTheme(theme) {
    root.setAttribute("data-theme", theme);
    localStorage.setItem("electrolens-theme", theme);
    themeToggleBtn.textContent = theme === "dark" ? "üåô" : "‚òÄ";
  }

  (function initTheme() {
    const saved = localStorage.getItem("electrolens-theme");
    const initial = saved === "light" ? "light" : "dark";
    applyTheme(initial);
  })();

  themeToggleBtn.addEventListener("click", () => {
    const current = root.getAttribute("data-theme") || "dark";
    const next = current === "dark" ? "light" : "dark";
    applyTheme(next);
  });

  // DOM references for scanner
  const modeTabs = document.querySelectorAll(".mode-tab");
  const modePanels = {
    camera: document.getElementById("mode-camera"),
    upload: document.getElementById("mode-upload"),
    manual: document.getElementById("mode-manual"),
  };

  const modelSelect = document.getElementById("modelSelect");
  const modelChip = document.getElementById("modelChip");

  const video = document.getElementById("camera");
  const cameraPreview = document.getElementById("cameraCapturePreview");
  const analyzeCameraBtn = document.getElementById("analyzeCameraBtn");
  const toggleCameraBtn = document.getElementById("toggleCameraBtn");
  const cameraStatusText = document.getElementById("cameraStatusText");
  const cameraLoader = document.getElementById("cameraLoader");

  const uploadDropzone = document.getElementById("uploadDropzone");
  const uploadPrompt = document.getElementById("uploadPrompt");
  const uploadPreview = document.getElementById("uploadPreview");
  const fileInput = document.getElementById("fileInput");
  const analyzeUploadBtn = document.getElementById("analyzeUploadBtn");

  const manualInput = document.getElementById("manualInput");
  const manualSearchBtn = document.getElementById("manualSearchBtn");

  const canvas = document.getElementById("captureCanvas");

  const deviceNameEl = document.getElementById("deviceName");
  const deviceCategoryEl = document.getElementById("deviceCategory");
  const descriptionEl = document.getElementById("description");
  const typicalUsesEl = document.getElementById("typicalUses");
  const whereToBuyEl = document.getElementById("whereToBuy");
  const keySpecsEl = document.getElementById("keySpecs");
  const projectIdeasEl = document.getElementById("projectIdeas");
  const commonMistakesEl = document.getElementById("commonMistakes");
  const datasheetHintEl = document.getElementById("datasheetHint");
  const referencesEl = document.getElementById("referencesSection");
  const shopLinksEl = document.getElementById("shopLinks");
  const refImageEl = document.getElementById("refImage");
  const usageImageEl = document.getElementById("usageImage");
  const pinoutImageEl = document.getElementById("pinoutImage");
  const aiStatusText = document.getElementById("aiStatusText");
  const globalLoader = document.getElementById("globalLoader");

  let cameraStream = null;
  let analyzing = false;

  const MODEL_LABELS = {
    auto: "Auto (Gemini + Groq)",
    gemini: "Gemini only",
    groq: "Groq",
    deepseek: "DeepSeek"
  };

  let selectedModel = localStorage.getItem("electrolens-model") || "auto";

  function applyModelSelection(model) {
    const normalized = ["auto", "gemini", "groq", "deepseek"].includes(model)
      ? model
      : "auto";
    selectedModel = normalized;
    localStorage.setItem("electrolens-model", normalized);
    if (modelSelect) modelSelect.value = normalized;
    if (modelChip) modelChip.textContent = "Mode: " + (MODEL_LABELS[normalized] || MODEL_LABELS.auto);
  }

  function initModelSelection() {
    applyModelSelection(selectedModel);
  }

  initModelSelection();

  modelSelect.addEventListener("change", (e) => {
    applyModelSelection(e.target.value);
    aiStatusText.textContent = "Model set to " + (MODEL_LABELS[selectedModel] || selectedModel) + " ‚Äì analyze a component.";
  });

  // Mode switching
  modeTabs.forEach(tab => {
    tab.addEventListener("click", () => {
      const mode = tab.dataset.mode;
      modeTabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");

      Object.keys(modePanels).forEach(key => {
        modePanels[key].style.display = key === mode ? "block" : "none";
      });

      if (mode !== "camera") stopCamera();
    });
  });

  // Camera
  async function startCamera() {
    try {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        cameraStatusText.textContent = "Camera not supported.";
        return;
      }
      cameraStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
      });
      video.srcObject = cameraStream;
      analyzeCameraBtn.disabled = false;
      cameraStatusText.textContent = "Camera active";
      toggleCameraBtn.textContent = "‚èπ Stop camera";
    } catch (err) {
      console.error(err);
      cameraStatusText.textContent = "Permission denied or no camera.";
    }
  }

  function stopCamera() {
    if (cameraStream) {
      cameraStream.getTracks().forEach(t => t.stop());
      cameraStream = null;
    }
    video.srcObject = null;
    analyzeCameraBtn.disabled = true;
    cameraPreview.style.display = "none";
    cameraStatusText.textContent = "Camera stopped";
    toggleCameraBtn.textContent = "‚ñ∂ Start camera";
  }

  toggleCameraBtn.addEventListener("click", () => {
    if (cameraStream) stopCamera();
    else startCamera();
  });

  analyzeCameraBtn.addEventListener("click", async () => {
    if (!cameraStream || analyzing) return;
    const w = video.videoWidth || 640;
    const h = video.videoHeight || 480;
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, w, h);
    const dataURL = canvas.toDataURL("image/jpeg", 0.85);

    cameraPreview.src = dataURL;
    cameraPreview.style.display = "block";
    cameraStatusText.textContent = "Frame captured ‚Äì analyzing‚Ä¶";
    video.pause();
    cameraLoader.style.display = "block";

    await analyzeWithBackend({ image: dataURL, queryText: "" });

    if (cameraStream) {
      cameraPreview.style.display = "none";
      cameraStatusText.textContent = "Camera active";
      video.play();
    }
    cameraLoader.style.display = "none";
  });

  // Upload
  uploadDropzone.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", e => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      const dataURL = evt.target.result;
      showUploadPreview(dataURL);
    };
    reader.readAsDataURL(file);
  });

  uploadDropzone.addEventListener("dragover", e => {
    e.preventDefault();
    uploadDropzone.classList.add("dragover");
  });

  uploadDropzone.addEventListener("dragleave", e => {
    e.preventDefault();
    uploadDropzone.classList.remove("dragover");
  });

  uploadDropzone.addEventListener("drop", e => {
    e.preventDefault();
    uploadDropzone.classList.remove("dragover");
    const file = e.dataTransfer.files && e.dataTransfer.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      const dataURL = evt.target.result;
      showUploadPreview(dataURL);
    };
    reader.readAsDataURL(file);
  });

  function showUploadPreview(dataURL) {
    uploadPreview.src = dataURL;
    uploadPreview.style.display = "block";
    uploadPrompt.style.display = "none";
    analyzeUploadBtn.disabled = false;
    analyzeUploadBtn.onclick = async () => {
      await analyzeWithBackend({ image: dataURL, queryText: "" });
    };
  }

  // Manual search
  manualSearchBtn.addEventListener("click", () => {
    const text = manualInput.value.trim();
    if (!text || analyzing) return;
    analyzeWithBackend({ image: null, queryText: text });
  });

  manualInput.addEventListener("keypress", e => {
    if (e.key === "Enter") manualSearchBtn.click();
  });

  // ===== analyzeWithBackend with model + blank-section explanation =====
  async function analyzeWithBackend(payload) {
    analyzing = true;
    globalLoader.style.display = "inline-block";
    aiStatusText.textContent = "Analyzing component with " + (MODEL_LABELS[selectedModel] || selectedModel) + "‚Ä¶";

    try {
      const res = await fetch("/api/electro-lookup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          ...payload,
          preferredModel: selectedModel
        })
      });

      let data = null;
      try {
        data = await res.json();
      } catch (parseErr) {
        console.error("Failed to parse JSON from backend:", parseErr);
      }

      const quotaWarnings =
        data && data.meta && Array.isArray(data.meta.quotaWarnings)
          ? data.meta.quotaWarnings
          : [];

      // If backend returned an error (4xx/5xx), show reason + quota info
      if (!res.ok || !data) {
        const baseError = (data && (data.error || data.message)) || "Backend error.";
        const detailsText = data && data.details ? ` (${data.details})` : "";

        const quotaText = quotaWarnings.length
          ? " | API quota/config notice: " +
            quotaWarnings
              .map(q => `${q.source}: ${q.message}`)
              .join(" ¬∑ ")
          : "";

        aiStatusText.textContent = `${baseError}${detailsText}${quotaText}`;

        descriptionEl.innerHTML =
          '<p class="placeholder">Analysis failed. This is often caused by API quota limits or missing API keys (Gemini, Groq, DeepSeek, Google CSE, Serper). Try again later, check your keys, or switch the AI model in the selector.</p>';
        return;
      }

      // Backend OK: render encyclopedia content (renderResult will set final status)
      renderResult(data, payload.queryText || "");
    } catch (err) {
      console.error(err);
      aiStatusText.textContent =
        "Error ‚Äì check console or API configuration (Gemini / Groq / DeepSeek / Google / Serper).";
      descriptionEl.innerHTML =
        '<p class="placeholder">Failed to analyze. Please verify your API keys and quotas, then try again or switch AI model.</p>';
    } finally {
      analyzing = false;
      globalLoader.style.display = "none";
      cameraLoader.style.display = "none";
    }
  }

  function renderList(el, arr, emptyText) {
    el.innerHTML = "";
    if (!Array.isArray(arr) || arr.length === 0) {
      el.innerHTML = `<p class="placeholder">${emptyText}</p>`;
      return;
    }
    const ul = document.createElement("ul");
    arr.forEach(item => {
      const li = document.createElement("li");
      li.textContent = item;
      ul.appendChild(li);
    });
    el.appendChild(ul);
  }

  function renderResult(r, queryText) {
    const meta = r.meta || {};
    const quotaWarnings = Array.isArray(meta.quotaWarnings) ? meta.quotaWarnings : [];
    const backendModel = meta.preferredModel || selectedModel || "auto";

    // Sync UI to the model actually used by backend (including fallbacks)
    applyModelSelection(backendModel);

    const modelLabel = MODEL_LABELS[backendModel] || MODEL_LABELS.auto;

    deviceNameEl.textContent = r.name || queryText || "Unknown device";
    deviceCategoryEl.textContent = r.category || "Other";

    // Description
    descriptionEl.innerHTML = "";
    const p = document.createElement("p");
    p.textContent = r.description || "No description available from the current model.";
    descriptionEl.appendChild(p);

    renderList(
      typicalUsesEl,
      r.typical_uses,
      "No typical uses listed by this model."
    );
    renderList(
      whereToBuyEl,
      r.where_to_buy,
      "No buying sources listed by this model."
    );
    renderList(
      keySpecsEl,
      r.key_specs,
      "No key specs were returned by this model."
    );
    renderList(
      projectIdeasEl,
      r.project_ideas,
      "No project ideas were generated by this model."
    );
    renderList(
      commonMistakesEl,
      r.common_mistakes,
      "No common mistakes were returned by this model."
    );

    datasheetHintEl.innerHTML = "";
    const dh = document.createElement("p");
    dh.textContent =
      r.datasheet_hint ||
      "No specific datasheet hint from the model ‚Äì search for the device name + 'datasheet' in your browser.";
    datasheetHintEl.appendChild(dh);

    referencesEl.innerHTML = "";
    let hasRefs = false;

    if (r.datasheet_url) {
      const a = document.createElement("a");
      a.href = r.datasheet_url;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.className = "shop-btn";
      a.textContent = "üìÑ Open datasheet";
      referencesEl.appendChild(a);
      hasRefs = true;
    }

    if (Array.isArray(r.references) && r.references.length > 0) {
      r.references.forEach(ref => {
        const wrapper = document.createElement("p");
        const link = document.createElement("a");
        link.href = ref.url;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.className = "ref-link";
        link.textContent = ref.title || ref.url;
        wrapper.appendChild(link);
        if (ref.snippet) {
          const sn = document.createElement("div");
          sn.className = "ref-snippet";
          sn.textContent = ref.snippet;
          wrapper.appendChild(sn);
        }
        referencesEl.appendChild(wrapper);
        hasRefs = true;
      });
    }

    if (!hasRefs) {
      referencesEl.innerHTML =
        '<p class="placeholder">No external references were returned. This may happen when search APIs are limited or the part name is ambiguous.</p>';
    }

    shopLinksEl.innerHTML = "";
    if (r.shop_links) {
      if (r.shop_links.shopee) {
        shopLinksEl.innerHTML += `<a class="shop-btn" href="${r.shop_links.shopee}" target="_blank">Shopee</a>`;
      }
      if (r.shop_links.lazada) {
        shopLinksEl.innerHTML += `<a class="shop-btn" href="${r.shop_links.lazada}" target="_blank">Lazada</a>`;
      }
      if (r.shop_links.amazon) {
        shopLinksEl.innerHTML += `<a class="shop-btn" href="${r.shop_links.amazon}" target="_blank">Amazon</a>`;
      }
      if (r.shop_links.aliexpress) {
        shopLinksEl.innerHTML += `<a class="shop-btn" href="${r.shop_links.aliexpress}" target="_blank">AliExpress</a>`;
      }
    }
    if (r.official_store) {
      shopLinksEl.innerHTML += `<a class="shop-btn" href="${r.official_store}" target="_blank">Official store</a>`;
    }
    if (!shopLinksEl.innerHTML.trim()) {
      shopLinksEl.innerHTML =
        '<span class="placeholder">No online shop links generated for this item.</span>';
    }

    if (r.real_image) {
      refImageEl.src = r.real_image;
      refImageEl.style.display = "block";
    } else {
      refImageEl.style.display = "none";
    }

    if (r.usage_image) {
      usageImageEl.src = r.usage_image;
      usageImageEl.style.display = "block";
    } else {
      usageImageEl.style.display = "none";
    }

    if (r.pinout_image) {
      pinoutImageEl.src = r.pinout_image;
      pinoutImageEl.style.display = "block";
    } else {
      pinoutImageEl.style.display = "none";
    }

    // ----- Explain missing sections + suggest switching model -----
    const missingSections = [];

    if (!r.description) missingSections.push("overview");
    if (!Array.isArray(r.typical_uses) || !r.typical_uses.length) missingSections.push("typical uses");
    if (!Array.isArray(r.where_to_buy) || !r.where_to_buy.length) missingSections.push("where to buy");
    if (!Array.isArray(r.key_specs) || !r.key_specs.length) missingSections.push("key specs");
    if (!Array.isArray(r.project_ideas) || !r.project_ideas.length) missingSections.push("project ideas");
    if (!Array.isArray(r.common_mistakes) || !r.common_mistakes.length) missingSections.push("common mistakes");
    if (!r.datasheet_url && (!Array.isArray(r.references) || !r.references.length)) missingSections.push("datasheet & references");
    if (!r.real_image) missingSections.push("component photo");
    if (!r.usage_image) missingSections.push("usage image");
    if (!r.pinout_image) missingSections.push("pinout diagram");

    let statusMsg = `Done ‚Äì using ${modelLabel}.`;

    if (quotaWarnings.length) {
      const qShort = quotaWarnings.map(q => q.source).join(", ");
      statusMsg += ` Some APIs reported quota or configuration issues: ${qShort}.`;
    }

    if (missingSections.length) {
      statusMsg += ` Some sections are empty (${missingSections.join(", ")}). `;

      if (quotaWarnings.length) {
        statusMsg += `These gaps are likely due to those API limits or missing keys.`;
      } else {
        statusMsg += `This can happen when the selected model returns limited structured data or cannot fetch matching images.`;
      }

      const suggestAlt =
        backendModel === "auto"
          ? "Try switching explicitly to Gemini, Groq, or DeepSeek in the AI Model selector and re-analyze."
          : backendModel === "gemini"
          ? "Try Groq or DeepSeek for a more detailed text encyclopedia and re-analyze."
          : backendModel === "groq"
          ? "Try Gemini or DeepSeek if you need different style/spec coverage, then re-analyze."
          : "Try Gemini or Groq if you need a different style of explanation or images, then re-analyze.";

      statusMsg += " " + suggestAlt;
    }

    if (!missingSections.length && !quotaWarnings.length) {
      statusMsg = `Done ‚Äì using ${modelLabel}. All sections populated. Analyze another item if you like.`;
    }

    aiStatusText.textContent = statusMsg;
  }

  window.addEventListener("load", () => {
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      cameraStatusText.textContent = "Requesting camera access‚Ä¶";
      startCamera();
    } else {
      cameraStatusText.textContent = "Camera not supported on this device.";
    }
  });
</script>

</body>
</html>
